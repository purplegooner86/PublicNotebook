#import <stdio.h>

/*
    * Would reccomend compiling with -w because this thing throws a whole lot of warnings
    *
    * The purpose of this is to demonstrate some of the interesting format specifiers available to us in C
    * This should help give an understanding of how these exploits are working
*/

int main()
{
    int a = 65;
    long b = 4;
    int c = 10;

    printf("%x.%x.%x\n", a, b, &a); // %x will print hex values, if you give it the address of something it will print that address in hex
    printf("%x.%x.%x\n"); // If you forget to give it the right amount of parameters, it will just start printing things anyway
    fflush(stdin);

    // Look at this in gdb, it will give you a better sense for where it is getting its values
    // The printf calling convention on linux is to put arguments 1-6 in rdi, rsi, rdx, rcx, r8, and r9
    // rdi will contain the format string at the time of the call
    // Try setting the rest of those registers values with something like set $rsi = 'a' in gdb
    // You will see that the first 5 hex values printed are the five values you set those registers
    // Then, it will start moving down the stack, printing those values
    // Look at the top of the $rsp at the time of the call; that value will be the sixth value printed
    printf("%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x\n");

    // %i$x will print the ith hex value
    printf("%8$x %3$x\n", a, b, c, a, b, c, a, b);

    
    // The %n format specifier will write the number of bytes written so far by printf, to the memory address given as parameter
    // ie:
    printf("aaa%n\n", &a);
    printf("a = %d\n", a); // will print a = 3

    // We can also use %6$n to print store the result in the 6th address provided
    // ie:
    printf("aaaaaa%6$n\n", &c, &c, &c, &c, &c, &a);
    printf("a = %d\n", a); // will print a = 6

    // Using %ix will print the argument padded to at least i bytes
    // Note: if i < 8 (64-bit) the width will just be 8
    printf("%150xsee, I am allthe way over here\n", a);

    // We can use that to write larger numbers to memory ie:
    printf("%600x%n\n", a, &a);
    printf("a = %d\n", a); // will print a = 600


    return 0;
}