import angr

# sample is a 64-bit dynamically linked executable
# PIE is enabled

# What this program is doing is pretty obvious, but it was for the sake of figuring out how to use angr on PIE binaries

target = angr.Project('sample')

# Finding addresses:
# Need to account for PIE: Make sure you have rebased your program to 0 before grabbing offset

# Specify the address which means we have the incorrect input:
bad_addr = 0x11ed + target.loader.main_object.min_addr

# Specify the address which means we have the correct input:
good_addr = 0x1365 + target.loader.main_object.min_addr

# Establish the entry state
entry_state = target.factory.entry_state()

# Establish the simulation
simulation = target.factory.simulation_manager(entry_state)

# Start the simulation
simulation.explore(find = good_addr, avoid = bad_addr)

solution = simulation.found[0].posix.dumps(0)

print(solution)