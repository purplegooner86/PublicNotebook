#include <stdio.h>
#include <stdlib.h>
#include <time.h>

/*
    * prepared is a 64-bit executable
    * After REing we find that it seeds rand with time and then makes us guess 50 numbers
    * Those 50 numbers are the output of an algorithm on rand()
    * Note: the algorithm actually being performed on the rands is % 100
    * prepared also tokenizes our input on \n, so we can run this with:
    * ./solution | ./prepared
*/


/* Helper function to force an arithmetic right shift */
int sar(int target, int shift_amt)
{
    int mask = 0xFFFFFFFF;

    if ((target & 0x80000000) == 0)
    {
        return (target >> shift_amt);
    }
    mask = mask << (32 - shift_amt);

    return (target >> shift_amt) | mask;

}

int main(int argc, char** argv)
{
    srand(time(0));

    long bit_mask = 0xFFFFFFFF00000000;
    int ecx, edx, eax;
    long mult_result;

    int counter = 0;

    while (counter <= 49)
    {
        ecx = rand();
        mult_result = (long)ecx * 1374389535;

        edx = ((mult_result & bit_mask) >> 32) & ~bit_mask;

        edx = sar(edx, 5);
        eax = ecx;
        eax = sar(eax, 31); // really just preserving the sign of the original number

        edx -= eax;
        eax = edx;

        eax = eax * 100;

        ecx -= eax;
        eax = ecx; 

        printf("%d\n", eax);
        counter++;
    }
}

