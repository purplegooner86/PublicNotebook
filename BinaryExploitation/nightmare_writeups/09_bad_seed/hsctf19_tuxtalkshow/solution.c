#include <time.h>
#include <stdio.h>
#include <stdint.h>
#include <stdlib.h>

/*
*   tuxtalkshow is a 64-bit executable that asks for a user input and reads a flag file if that user input is correct
*   By reversing, we can see that it seeds rand() with current time, and then does an algorithm on 6 randomly generated
*   ints to determine what the correct number is
*   By seeding our own rand with time and then mimicing the algorithm, we can generate the same numbers
*   Then, we can run with ./solution | ./tuxtalkshow
*/



/*
    * Helper function to guarantee a arithmetic right shift
*/
int shift_right_arithmetic(int input, int shift_amnt)
{
    uint32_t mask = 0xFFFFFFFF;

    if (input >= 0) // For positive numbers it doesn't matter if shift is logical or arithmetic
    {
        return (input >> shift_amnt);
    }

    input = input >> shift_amnt;
    mask = mask << (32 - shift_amnt);

    return input | mask;
}

int main()
{
    srand(time(0));

    int var_260[6] = {121, 1231231, 20312312, 122342342, 90988878, 4294967266};
    int counter = 0;

    long bit_mask = 0xFFFFFFFF00000000;

    uint32_t ecx;
    long temp_long;

    int eax;
    int edx;

    while (counter < 6)
    {
        ecx = rand();
        temp_long = (long)ecx * 0x66666667; //0110

        edx = ((temp_long & bit_mask) >> 32) & ~bit_mask;

        edx = shift_right_arithmetic(edx, 2); //edx = edx >> 2;
        eax = ecx;
        eax = shift_right_arithmetic(eax, 31); //eax = eax >> 31;

        edx -= eax;
        eax = edx;

        eax = eax << 2;
        eax += edx;
        eax += eax;

        ecx -= eax;
        edx = ecx;
        edx--;

        var_260[counter] = var_260[counter] - edx;

        counter++;
    }

    int running_sum = 0;

    for(int i = 0; i < 6; i++)
    {
        running_sum += var_260[i];
    }

    printf("%d\n", running_sum);

    return 0;
}